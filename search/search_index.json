{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"BarFinder \u2014 Internal Documentation","text":"<p>Welcome to the internal documentation for BarFinder, a location-based nightlife discovery platform.</p> <p>Barfinder enables users to discover nearby bars, pubs, clubs, and venues through a map-first experience, enhanced by conversational search, venue metadata, and social signals such as points, activity, and vibe.</p> <p>This documentation is intended for:</p> <ul> <li>Frontend (React Native)</li> <li>Backend (Firebase / Cloud Functions)</li> <li>Product and platform</li> </ul>"},{"location":"#repositories","title":"Repositories","text":"BarFinder Mobile BarFinder Backend BarFinder Documentation Open repo Open repo Open repo"},{"location":"#overview","title":"Overview","text":"<p>Barfinder is built around a simple core experience:</p> <p>Show users what venues are nearby, what the atmosphere is like, and where it\u2019s worth going right now.</p> <p>The AI-driven conversational layer exists to enhance discovery, not replace it.  </p> <p>The primary product surface is the map, where users can:</p> <ul> <li>Explore nearby venues</li> <li>Compare vibe, mood, and popularity</li> <li>View real-world context (distance, weather, time)</li> <li>Earn points through engagement and check-ins</li> <li>See where activity is happening</li> </ul>"},{"location":"#high-level-architecture","title":"High-Level Architecture","text":""},{"location":"#client","title":"Client","text":"<ul> <li>React Native application</li> <li>Map-based discovery UI</li> <li>Venue cards and detail views</li> <li>Conversational search input</li> <li>Firebase Authentication</li> </ul>"},{"location":"#backend","title":"Backend","text":"<ul> <li>Firebase Cloud Functions (HTTP + Callable)</li> <li>Firestore (NoSQL)</li> <li>Firebase Authentication (ID tokens)</li> <li>Geospatial querying (GeoFire)</li> <li>Intent classification for search refinement</li> </ul>"},{"location":"#core-domains","title":"Core Domains","text":"<ul> <li>Accounts and profiles</li> <li>Map and venue discovery</li> <li>Check-ins and engagement</li> <li>Social connections</li> </ul>"},{"location":"#core-user-flows","title":"Core User Flows","text":"<ul> <li>Authenticate via Firebase Auth</li> <li>Browse nearby venues on a map</li> <li>Filter and refine venues by vibe, type, and context</li> <li>Use natural language to refine discovery</li> <li>Check in to venues and earn points</li> <li>View venue popularity and atmosphere</li> <li>Connect with friends and see shared activity</li> </ul>"},{"location":"#documentation-areas","title":"Documentation Areas","text":"<p>Use the sections below to navigate directly to relevant documentation.</p>"},{"location":"#account-apis","title":"Account APIs","text":"<p>Endpoints related to user identity, profile data, and preferences.</p> <ul> <li>Get User Information</li> <li>Update User Information</li> </ul> <p>See: <code>APIs \u2192 Account</code></p>"},{"location":"#connections-apis","title":"Connections APIs","text":"<p>Endpoints supporting social features.</p> <ul> <li>Respond to Friend Request</li> </ul> <p>See: <code>APIs \u2192 Connections</code></p>"},{"location":"#map-and-discovery-apis","title":"Map and Discovery APIs","text":"<p>Endpoints that power venue discovery and map-based experiences.</p> <ul> <li>Get Nearby Venues (raw geospatial search)</li> <li>Nightlife Query (AI-assisted discovery and refinement)</li> </ul> <p>See: <code>APIs \u2192 Map</code></p>"},{"location":"#check-ins-and-engagement","title":"Check-ins and Engagement","text":"<p>Endpoints related to user activity, check-ins, and loyalty.</p> <p>See: <code>APIs \u2192 Check-ins</code></p>"},{"location":"#key-concepts","title":"Key Concepts","text":""},{"location":"#map-first-discovery","title":"Map-First Discovery","text":"<p>The map is the primary interface. All discovery flows ultimately resolve to a set of venues rendered geographically, ordered by relevance, distance, and context.</p> <p>AI is used to refine and interpret intent, not to invent data.</p>"},{"location":"#action-based-responses","title":"Action-Based Responses","text":"<p>Some endpoints return an <code>action</code> field that explicitly instructs frontend behaviour.</p> <ul> <li><code>message</code> \u2014 update conversational UI only</li> <li><code>both</code> \u2014 update map state and venue cards</li> </ul> <p>This keeps backend logic deterministic and frontend state predictable.</p>"},{"location":"#semantic-intent-explainable","title":"Semantic Intent (Explainable)","text":"<p>Semantic intent allows natural language queries to map onto known venue attributes.</p> <p>Examples: - \u201cplace to dance\u201d \u2192 venues with DJs and dancefloors - \u201coutdoor drinks\u201d \u2192 venues marked as outdoor, combined with weather context - \u201cmore chill\u201d \u2192 lounges, wine bars, cocktail bars</p> <p>All filtering is based on known schema and rules.</p>"},{"location":"#how-to-use-these-docs","title":"How to Use These Docs","text":"<ul> <li>Treat API documentation as contracts</li> <li>Do not rely on undocumented fields</li> <li>Frontend behaviour is explicitly defined per endpoint</li> <li>Backend changes should be reflected in documentation alongside code</li> </ul>"},{"location":"#quick-navigation","title":"Quick Navigation","text":"<ul> <li>Nightlife discovery: <code>APIs \u2192 Map \u2192 Nightlife Query</code></li> <li>Raw venue search: <code>APIs \u2192 Map \u2192 Get Nearby Venues</code></li> <li>User profile data: <code>APIs \u2192 Account \u2192 Get User Information</code></li> <li>Social connections: <code>APIs \u2192 Connections \u2192 Respond to Friend Request</code></li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>When adding new functionality:</p> <ol> <li>Implement the Cloud Function</li> <li>Create or update the corresponding <code>.md</code> file</li> <li>Place it in the appropriate domain folder</li> <li>Update navigation once the API stabilises</li> </ol> <p>Barfinder internal documentation.</p>"},{"location":"firestore/","title":"Why Firestore","text":"<p>This document explains Firestore as the primary data layer for BarFinder, from both a technical and product perspective.</p>"},{"location":"firestore/#overview","title":"Overview","text":"<p>Barfinder is a map-first, real-time, mobile application with the following characteristics:</p> <ul> <li>Heavy read patterns (map discovery, filters, history)</li> <li>Event-based writes (check-ins, signals)</li> <li>Strong user scoping (per-user data)</li> <li>Minimal need for complex joins</li> <li>A strong preference for low latency and offline tolerance</li> </ul>"},{"location":"firestore/#firestore-as-the-primary-api","title":"Firestore as the Primary API","text":"<p>Firestore is not just a database \u2014 it acts as the primary application API.</p> <p>Instead of:</p> <pre><code>Client \u2192 REST API \u2192 Database\n</code></pre> <p>Barfinder often uses:</p> <pre><code>Client \u2192 Firestore SDK \u2192 Database\n</code></pre> <p>This removes an entire layer for many read and write operations.</p>"},{"location":"firestore/#what-this-enables","title":"What this enables","text":"<ul> <li>No REST endpoints for basic reads</li> <li>No API versioning for simple queries</li> <li>No backend scaling concerns for read-heavy paths</li> <li>Direct, strongly-typed access from the client</li> </ul> <p>For many features, Firestore replaces: - CRUD REST endpoints - DTO mapping layers - API gateways</p>"},{"location":"firestore/#firestore-query-model","title":"Firestore Query Model","text":"<p>Firestore supports structured, indexed queries that map cleanly to BarFinder\u2019s needs:</p> <ul> <li>Equality filters (<code>where(\"flags.outdoor\", \"==\", true)</code>)</li> <li>Array membership (<code>array-contains</code>, <code>array-contains-any</code>)</li> <li>Range filters (<code>orderBy</code> + bounds)</li> <li>Deterministic pagination</li> </ul> <p>This aligns well with:</p> <ul> <li>Map filtering</li> <li>Shortcuts (saved filters)</li> <li>User history</li> <li>Venue discovery</li> </ul> <p>With this, there is no need for ad-hoc SQL or server-side query construction.</p>"},{"location":"firestore/#map-geo-queries","title":"Map &amp; Geo Queries","text":"<p>Firestore does not natively support geo-radius queries, but this is solved cleanly using:</p> <ul> <li>Geohashes</li> <li>Range queries</li> <li>Client-side distance filtering</li> </ul> <p>This approach:</p> <ul> <li>Scales horizontally</li> <li>Avoids spatial indexes tied to a single database vendor</li> <li>Keeps queries deterministic and cacheable</li> </ul> <p>Importantly, geo queries are read-only and safe to expose directly to the client.</p>"},{"location":"firestore/#offline-network-resilience","title":"Offline &amp; Network Resilience","text":"<p>Firestore\u2019s client SDK provides:</p> <ul> <li>Built-in offline persistence</li> <li>Automatic sync when connectivity returns</li> <li>Optimistic UI updates</li> </ul> <p>This is critical for a nightlife app where:</p> <ul> <li>Connectivity is inconsistent</li> <li>Users move frequently</li> <li>Map state should not block on the network</li> </ul> <p>A traditional REST API would require:</p> <ul> <li>Custom caching layers</li> <li>Manual retry logic</li> <li>Conflict resolution strategies</li> </ul> <p>Firestore provides this out of the box.</p>"},{"location":"firestore/#security-rules-vs-rest-auth","title":"Security Rules vs REST Auth","text":"<p>Firestore security rules replace a large class of REST API logic.</p> <p>Instead of writing backend code to check:</p> <ul> <li>Who can read a document</li> <li>Who can write to a path</li> <li>Whether data is user-owned</li> </ul> <p>Rules are declared once, centrally, and enforced automatically.</p>"},{"location":"firestore/#example-concept","title":"Example Concept","text":"<pre><code>users/{uid} is readable and writable only by uid\nvenues/{venueId} is readable by anyone\nvenues/{venueId}/signals is write-only via trusted paths\n</code></pre> <p>This eliminates:</p> <ul> <li>Boilerplate auth checks in controllers</li> <li>Duplicate logic across endpoints</li> <li>Entire classes of authorisation bugs</li> </ul> <p>Security is enforced at the database boundary, not in app code.</p>"},{"location":"firestore/#reduced-need-for-rest-apis","title":"Reduced Need for REST APIs","text":"<p>REST APIs are still used where appropriate:</p> <ul> <li>Check-ins (distance verification, cooldowns)</li> <li>AI-backed endpoints</li> <li>Aggregation jobs</li> </ul> <p>But Firestore removes the need for REST APIs for:</p> <ul> <li>Reading venues</li> <li>Reading user data</li> <li>Reading shortcuts</li> <li>Saving client-owned state</li> </ul> <p>This results in:</p> <ul> <li>Fewer Cloud Functions</li> <li>Lower cold-start impact</li> <li>Less surface area to maintain</li> </ul>"},{"location":"firestore/#event-based-data-model","title":"Event-Based Data Model","text":"<p>Firestore encourages event-based modelling:</p> <ul> <li>Check-ins are append-only</li> <li>Venue signals are append-only</li> <li>Aggregation happens asynchronously</li> </ul> <p>This aligns naturally with:</p> <ul> <li>Analytics</li> <li>Ranking</li> <li>Fraud detection</li> <li>Time-windowed logic</li> </ul> <p>A traditional relational model would require:</p> <ul> <li>Locking</li> <li>Upserts</li> <li>Transaction-heavy writes</li> </ul> <p>Firestore handles high-volume event writes cleanly.</p>"},{"location":"firestore/#scaling-characteristics","title":"Scaling Characteristics","text":"<p>Firestore scales automatically with:</p> <ul> <li>Read throughput</li> <li>Write throughput</li> <li>Concurrent clients</li> </ul> <p>There is no need to:</p> <ul> <li>Provision read replicas</li> <li>Tune indexes manually</li> <li>Scale API servers for reads</li> </ul> <p>This is especially important for map usage spikes (weekends, events).</p>"},{"location":"firestore/#cost-operational-simplicity","title":"Cost &amp; Operational Simplicity","text":"<p>Firestore reduces operational overhead:</p> <ul> <li>No database servers to manage</li> <li>No REST infra for basic reads</li> <li>No API gateways for most flows</li> </ul> <p>Costs scale primarily with:</p> <ul> <li>Reads</li> <li>Writes</li> <li>Stored data</li> </ul> <p>Which aligns closely with actual user activity.</p>"},{"location":"firestore/#trade-offs-limitations","title":"Trade-offs &amp; Limitations","text":"<p>Firestore is definitely not perfect.</p> <p>Known trade-offs:</p> <ul> <li>No joins</li> <li>Query constraints require forethought</li> <li>Composite indexes must be planned</li> <li>Complex reporting is externalised</li> </ul> <p>These are accepted deliberately because:</p> <ul> <li>The data model is document-oriented</li> <li>Relationships are shallow and explicit</li> <li>Analytics is handled outside the hot path</li> </ul>"},{"location":"apis/account/get-user-information/","title":"GET /getUserInformation","text":"<p>Returns authenticated user profile information, venue loyalty data, and recent check-ins for the requesting user.</p> <p>This endpoint only allows a user to access their own data. Accessing another user's information is explicitly forbidden.</p>"},{"location":"apis/account/get-user-information/#authentication","title":"Authentication","text":"<p>Required</p> <ul> <li>Firebase Authentication</li> <li>A valid Firebase ID token must be provided in the request header</li> </ul>"},{"location":"apis/account/get-user-information/#headers","title":"Headers","text":"<pre><code>Authorization: Bearer &lt;Firebase ID Token&gt;\n</code></pre> <p>The token is verified using <code>admin.auth().verifyIdToken</code>.</p>"},{"location":"apis/account/get-user-information/#request","title":"Request","text":""},{"location":"apis/account/get-user-information/#method","title":"Method","text":"<pre><code>GET\n</code></pre>"},{"location":"apis/account/get-user-information/#query-parameters","title":"Query Parameters","text":"Name Type Required Description <code>uid</code> string Yes Firebase UID of the authenticated user <p>Important: The <code>uid</code> in the query must match the UID in the Firebase ID token. Requests for other users\u2019 data will be rejected.</p>"},{"location":"apis/account/get-user-information/#authorization-rules","title":"Authorization Rules","text":"<ul> <li>The authenticated user may only request their own UID</li> <li>If <code>auth.uid !== uid</code>, the request is rejected with <code>403 Forbidden</code></li> </ul>"},{"location":"apis/account/get-user-information/#response-200-ok","title":"Response \u2014 200 OK","text":"<pre><code>{\n  \"user\": {\n    \"...\": \"user document fields\"\n  },\n  \"venues\": [\n    {\n      \"venueId\": \"string\",\n      \"...\": \"venue loyalty fields\"\n    }\n  ],\n  \"checkins\": [\n    {\n      \"checkinId\": \"string\",\n      \"...\": \"check-in fields\"\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/account/get-user-information/#response-fields","title":"Response Fields","text":""},{"location":"apis/account/get-user-information/#user","title":"<code>user</code>","text":"<p>The Firestore document located at:</p> <pre><code>users/{uid}\n</code></pre> <p>Contains the user\u2019s core profile data.</p>"},{"location":"apis/account/get-user-information/#venues","title":"<code>venues</code>","text":"<p>An array of venue loyalty summaries from:</p> <pre><code>users/{uid}/venues/{venueId}\n</code></pre> <p>Each item includes: - <code>venueId</code> (document ID) - All stored venue-related fields for the user</p>"},{"location":"apis/account/get-user-information/#checkins","title":"<code>checkins</code>","text":"<p>A list of the user\u2019s most recent check-ins, ordered by timestamp descending.</p> <ul> <li>Source collection:</li> </ul> <pre><code>users/{uid}/checkins\n</code></pre> <ul> <li>Sorted by: <code>timestamp</code> (descending)</li> <li>Maximum returned: 20 check-ins</li> </ul> <p>Each item includes: - <code>checkinId</code> (document ID) - All stored check-in fields</p>"},{"location":"apis/account/get-user-information/#error-responses","title":"Error Responses","text":""},{"location":"apis/account/get-user-information/#400-bad-request","title":"400 Bad Request","text":"<pre><code>{ \"error\": \"Missing uid parameter\" }\n</code></pre>"},{"location":"apis/account/get-user-information/#401-unauthorized","title":"401 Unauthorized","text":"<pre><code>{ \"error\": \"Missing or invalid Authorization header\" }\n</code></pre> <pre><code>{ \"error\": \"Invalid or expired token\" }\n</code></pre>"},{"location":"apis/account/get-user-information/#403-forbidden","title":"403 Forbidden","text":"<pre><code>{ \"error\": \"Forbidden: cannot access another user's data\" }\n</code></pre>"},{"location":"apis/account/get-user-information/#404-not-found","title":"404 Not Found","text":"<pre><code>{ \"error\": \"User not found\" }\n</code></pre>"},{"location":"apis/account/get-user-information/#405-method-not-allowed","title":"405 Method Not Allowed","text":"<pre><code>{ \"error\": \"Method not allowed\" }\n</code></pre>"},{"location":"apis/account/get-user-information/#500-internal-server-error","title":"500 Internal Server Error","text":"<pre><code>{ \"error\": \"Internal server error\" }\n</code></pre>"},{"location":"apis/account/get-user-information/#notes-for-react-native-clients","title":"Notes for React Native Clients","text":"<ul> <li>Always use the current user\u2019s Firebase ID token</li> <li>Do not allow clients to supply arbitrary UIDs</li> <li>Suitable for:</li> <li>Profile screens</li> <li>Loyalty dashboards</li> <li>Recent activity feeds</li> <li>Consider caching the response locally to reduce Firestore reads</li> </ul>"},{"location":"apis/account/get-user-information/#firestore-reads-per-request-approximate","title":"Firestore Reads Per Request (Approximate)","text":"Collection Reads <code>users/{uid}</code> 1 <code>users/{uid}/venues</code> N <code>users/{uid}/checkins</code> up to 20"},{"location":"apis/account/update-user-information/","title":"POST /updateUserInformation","text":"<p>Updates mutable profile fields for the authenticated user.</p> <p>This endpoint allows a user to update their own profile information such as name fields and preference flags. Partial updates are supported.</p>"},{"location":"apis/account/update-user-information/#authentication","title":"Authentication","text":"<p>Required</p> <ul> <li>Firebase Authentication</li> <li>A valid Firebase ID token must be provided in the request header</li> </ul>"},{"location":"apis/account/update-user-information/#headers","title":"Headers","text":"<pre><code>Authorization: Bearer &lt;Firebase ID Token&gt;\n</code></pre> <p>The token is verified using <code>admin.auth().verifyIdToken</code>.</p>"},{"location":"apis/account/update-user-information/#request","title":"Request","text":""},{"location":"apis/account/update-user-information/#method","title":"Method","text":"<pre><code>POST\n</code></pre>"},{"location":"apis/account/update-user-information/#body-parameters","title":"Body Parameters","text":"Name Type Required Description <code>firstName</code> string No User first name (letters, spaces, <code>'</code> and <code>-</code> only, max 40 chars) <code>lastName</code> string No User last name (letters, spaces, <code>'</code> and <code>-</code> only, max 40 chars) <code>flags</code> object No Map of user preference flags <p>At least one valid field must be provided.</p>"},{"location":"apis/account/update-user-information/#flags-object","title":"Flags Object","text":"<p>Supported flags:</p> Flag Values <code>locationAccess</code> <code>enabled</code> / <code>disabled</code> <code>notifications</code> <code>enabled</code> / <code>disabled</code> <code>shareStatus</code> <code>enabled</code> / <code>disabled</code> <code>marketingUpdates</code> <code>enabled</code> / <code>disabled</code> <p>Flags are written as a map to Firestore, not as dotted paths.</p>"},{"location":"apis/account/update-user-information/#example-request","title":"Example Request","text":"<pre><code>{\n  \"firstName\": \"Bob\",\n  \"lastName\": \"Smith\",\n  \"flags\": {\n    \"notifications\": \"enabled\",\n    \"marketingUpdates\": \"disabled\"\n  }\n}\n</code></pre>"},{"location":"apis/account/update-user-information/#response-200-ok","title":"Response \u2014 200 OK","text":"<pre><code>{\n  \"success\": true,\n  \"updatedFields\": [\n    \"firstName\",\n    \"lastName\",\n    \"flags\",\n    \"updatedAt\"\n  ]\n}\n</code></pre>"},{"location":"apis/account/update-user-information/#firestore-write","title":"Firestore Write","text":"<p>Writes to:</p> <pre><code>users/{uid}\n</code></pre> <ul> <li>Uses <code>merge: true</code></li> <li>Automatically updates <code>updatedAt</code> with server timestamp</li> </ul>"},{"location":"apis/account/update-user-information/#validation-rules","title":"Validation Rules","text":""},{"location":"apis/account/update-user-information/#names","title":"Names","text":"<ul> <li>Must be strings</li> <li>Trimmed</li> <li>Max length: 40 characters</li> <li>Allowed characters: letters, spaces, <code>'</code>, <code>-</code></li> </ul>"},{"location":"apis/account/update-user-information/#flags","title":"Flags","text":"<ul> <li>Must be an object</li> <li>Only predefined flags allowed</li> <li>Values must be <code>enabled</code> or <code>disabled</code></li> </ul>"},{"location":"apis/account/update-user-information/#error-responses","title":"Error Responses","text":""},{"location":"apis/account/update-user-information/#400-bad-request","title":"400 Bad Request","text":"<pre><code>{ \"error\": \"Invalid firstName\" }\n</code></pre> <pre><code>{ \"error\": \"Invalid lastName\" }\n</code></pre> <pre><code>{ \"error\": \"Invalid flags object\" }\n</code></pre> <pre><code>{ \"error\": \"No valid fields to update\" }\n</code></pre>"},{"location":"apis/account/update-user-information/#401-unauthorized","title":"401 Unauthorized","text":"<pre><code>{ \"error\": \"Missing Authorization header\" }\n</code></pre>"},{"location":"apis/account/update-user-information/#405-method-not-allowed","title":"405 Method Not Allowed","text":"<pre><code>{ \"error\": \"Method not allowed\" }\n</code></pre>"},{"location":"apis/account/update-user-information/#500-internal-server-error","title":"500 Internal Server Error","text":"<pre><code>{ \"error\": \"Internal server error\" }\n</code></pre>"},{"location":"apis/account/update-user-information/#notes-for-react-native-clients","title":"Notes for React Native Clients","text":"<ul> <li>Always send only changed fields</li> <li>Do not send empty objects</li> <li>Cache profile state locally and sync optimistically</li> <li>Flags are booleans internally, but API accepts string values</li> </ul>"},{"location":"apis/connections/respond-to-friend-request/","title":"respondToFriendRequest (Callable)","text":"<p>Accepts or declines an incoming friend request for the authenticated user.</p> <p>This is a Firebase Callable Function, intended to be invoked via the Firebase SDK (not via HTTP fetch).</p>"},{"location":"apis/connections/respond-to-friend-request/#authentication","title":"Authentication","text":"<p>Required</p> <ul> <li>Firebase Authentication</li> <li>The user must be signed in when calling this function</li> </ul> <p>If the user is not authenticated, the function throws:</p> <pre><code>{\n  \"code\": \"unauthenticated\",\n  \"message\": \"Authentication required.\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#request","title":"Request","text":""},{"location":"apis/connections/respond-to-friend-request/#invocation-type","title":"Invocation Type","text":"<pre><code>functions.httpsCallable('respondToFriendRequest')\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#payload","title":"Payload","text":"<pre><code>{\n  \"fromUid\": \"string\",\n  \"action\": \"accept\" | \"decline\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#fields","title":"Fields","text":"Field Type Required Description <code>fromUid</code> string Yes UID of the user who sent the friend request <code>action</code> string Yes Either <code>accept</code> or <code>decline</code>"},{"location":"apis/connections/respond-to-friend-request/#behaviour","title":"Behaviour","text":""},{"location":"apis/connections/respond-to-friend-request/#decline","title":"Decline","text":"<ul> <li>Deletes the friend request</li> <li>No friendship records are created</li> </ul>"},{"location":"apis/connections/respond-to-friend-request/#accept","title":"Accept","text":"<ul> <li>Creates a mutual friendship</li> <li>Deletes the original request</li> <li>All operations are executed atomically using a Firestore batch</li> </ul>"},{"location":"apis/connections/respond-to-friend-request/#response-200-ok","title":"Response \u2014 200 OK","text":""},{"location":"apis/connections/respond-to-friend-request/#declined","title":"Declined","text":"<pre><code>{\n  \"success\": true,\n  \"status\": \"declined\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#accepted","title":"Accepted","text":"<pre><code>{\n  \"success\": true,\n  \"status\": \"accepted\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#firestore-operations","title":"Firestore Operations","text":""},{"location":"apis/connections/respond-to-friend-request/#friend-request-location","title":"Friend Request Location","text":"<pre><code>users/{uid}/requests/{fromUid}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#friends-collections-on-accept","title":"Friends Collections (on accept)","text":"<pre><code>users/{uid}/friends/{fromUid}\nusers/{fromUid}/friends/{uid}\n</code></pre> <p>Each friendship document includes: - <code>createdAt</code> (server timestamp)</p>"},{"location":"apis/connections/respond-to-friend-request/#error-responses","title":"Error Responses","text":""},{"location":"apis/connections/respond-to-friend-request/#unauthenticated","title":"unauthenticated","text":"<pre><code>{\n  \"code\": \"unauthenticated\",\n  \"message\": \"Authentication required.\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#invalid-argument","title":"invalid-argument","text":"<pre><code>{\n  \"code\": \"invalid-argument\",\n  \"message\": \"fromUid is required and must be a string.\"\n}\n</code></pre> <pre><code>{\n  \"code\": \"invalid-argument\",\n  \"message\": \"action must be either \\\"accept\\\" or \\\"decline\\\".\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#not-found","title":"not-found","text":"<pre><code>{\n  \"code\": \"not-found\",\n  \"message\": \"Friend request does not exist.\"\n}\n</code></pre>"},{"location":"apis/connections/respond-to-friend-request/#notes-for-react-native-clients","title":"Notes for React Native Clients","text":"<ul> <li>Always call this using <code>httpsCallable</code>, not <code>fetch</code></li> <li>Optimistically update UI after success</li> <li>If declining, remove the request from local state immediately</li> <li>If accepting, add the user to the friends list on success</li> </ul>"},{"location":"apis/connections/respond-to-friend-request/#consistency-guarantees","title":"Consistency Guarantees","text":"<ul> <li>Accept flow is atomic</li> <li>No partial friend states are possible</li> <li>Either both users become friends, or nothing changes</li> </ul>"},{"location":"apis/map/get-nearby-venues/","title":"GET /getNearbyVenues","text":"<p>Returns a list of nearby venues within a specified radius.</p> <p>This endpoint returns the raw database shape for venues. No filtering, ranking, or semantic interpretation is applied.</p>"},{"location":"apis/map/get-nearby-venues/#authentication","title":"Authentication","text":"<p>Not required</p> <p>This endpoint is currently publicly accessible.</p>"},{"location":"apis/map/get-nearby-venues/#request","title":"Request","text":""},{"location":"apis/map/get-nearby-venues/#method","title":"Method","text":"<pre><code>GET\n</code></pre>"},{"location":"apis/map/get-nearby-venues/#query-parameters","title":"Query Parameters","text":"Name Type Required Description <code>lat</code> number Yes Latitude of the search centre <code>lon</code> number Yes Longitude of the search centre <code>radius</code> number Yes Search radius in meters"},{"location":"apis/map/get-nearby-venues/#example-request","title":"Example Request","text":"<pre><code>GET /getNearbyVenues?lat=-35.28&amp;lon=149.13&amp;radius=1200\n</code></pre>"},{"location":"apis/map/get-nearby-venues/#response-200-ok","title":"Response \u2014 200 OK","text":"<pre><code>{\n  \"count\": 2,\n  \"venues\": [\n    {\n      \"id\": \"venueId\",\n      \"name\": \"Venue Name\",\n      \"vibe\": \"string | null\",\n      \"mood\": \"string | null\",\n      \"amenities\": [],\n      \"types\": [],\n      \"flags\": {},\n      \"location\": {\n        \"lat\": -35.28,\n        \"lon\": 149.13,\n        \"geohash\": \"string\",\n        \"distanceMeters\": 450\n      },\n      \"weather\": null,\n      \"rating\": null,\n      \"reviewCount\": 0\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/map/get-nearby-venues/#behaviour","title":"Behaviour","text":"<ul> <li>Performs a query using geohash bounds</li> <li>Computes exact distance using <code>geofire-common</code></li> <li>Filters out venues outside the radius</li> <li>Results are sorted by distance (ascending)</li> </ul>"},{"location":"apis/map/get-nearby-venues/#error-responses","title":"Error Responses","text":""},{"location":"apis/map/get-nearby-venues/#400-bad-request","title":"400 Bad Request","text":"<pre><code>{ \"error\": \"Missing or invalid lat/lon/radius\" }\n</code></pre>"},{"location":"apis/map/get-nearby-venues/#notes-for-react-native-clients","title":"Notes for React Native Clients","text":"<ul> <li>This endpoint is best used for stand-alone data retriving. ie. map view.</li> <li>Client-facing search should prefer <code>/nightlifeQuery</code> when using AI</li> <li>Results may be large; consider paging or limiting client-side</li> </ul>"},{"location":"apis/map/nightlife-query/","title":"POST /nightlifeQuery","text":"<p>Primary AI-powered discovery endpoint for Barfinder.</p> <p>This endpoint combines: - Natural language chat - Intent classification - Geospatial venue search - Semantic filtering - Weather-aware enrichment - Safety-guarded responses</p> <p>It is designed to be the single entry point for nightlife discovery in the React Native app.</p>"},{"location":"apis/map/nightlife-query/#authentication","title":"Authentication","text":"<p>Not required This endpoint is publicly accessible.</p>"},{"location":"apis/map/nightlife-query/#request","title":"Request","text":""},{"location":"apis/map/nightlife-query/#method","title":"Method","text":"<pre><code>POST\n</code></pre>"},{"location":"apis/map/nightlife-query/#headers","title":"Headers","text":"<pre><code>Content-Type: application/json\n</code></pre>"},{"location":"apis/map/nightlife-query/#body-parameters","title":"Body Parameters","text":"Field Type Required Description <code>message</code> string No User natural language input <code>lat</code> number Yes User latitude <code>lon</code> number Yes User longitude <code>lastQuery</code> object No Previous query context for refinement"},{"location":"apis/map/nightlife-query/#operating-modes","title":"Operating Modes","text":"<p>The endpoint operates in three mutually exclusive modes, selected by AI intent classification:</p> <ol> <li>Chat Mode</li> <li>Query Mode</li> <li>Refine Mode</li> </ol> <p>The frontend must branch logic based on the returned <code>action</code> field.</p>"},{"location":"apis/map/nightlife-query/#response-200-ok","title":"Response \u2014 200 OK","text":""},{"location":"apis/map/nightlife-query/#mode-1-chat-safe-on-topic-small-talk","title":"Mode 1: Chat \u2014 Safe, On-Topic Small Talk","text":""},{"location":"apis/map/nightlife-query/#request_1","title":"Request","text":"<pre><code>{\n  \"message\": \"Hey!\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent","title":"AI Intent","text":"<pre><code>{ \"type\": \"chat\" }\n</code></pre>"},{"location":"apis/map/nightlife-query/#response","title":"Response","text":"<pre><code>{\n  \"action\": \"message\",\n  \"message\": \"Hey! What kind of night are you feeling \u2014 chill drinks or somewhere lively?\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#frontend-behaviour","title":"Frontend Behaviour","text":"<ul> <li>Show chat bubble</li> <li>Do not update map</li> <li>Do not show venue cards</li> </ul>"},{"location":"apis/map/nightlife-query/#mode-2-chat-out-of-scope-safety-enforced","title":"Mode 2: Chat \u2014 Out of Scope (Safety Enforced)","text":""},{"location":"apis/map/nightlife-query/#request_2","title":"Request","text":"<pre><code>{\n  \"message\": \"Write me a Python function\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent_1","title":"AI Intent","text":"<pre><code>{ \"type\": \"chat\" }\n</code></pre>"},{"location":"apis/map/nightlife-query/#response-hard-stop","title":"Response (Hard Stop)","text":"<pre><code>{\n  \"action\": \"message\",\n  \"message\": \"I can help with bars, venues, and planning a night out.\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#frontend-behaviour_1","title":"Frontend Behaviour","text":"<ul> <li>Show message</li> <li>Do not retry</li> <li>Do not call venue search</li> <li>Treat as terminal response</li> </ul>"},{"location":"apis/map/nightlife-query/#mode-3-basic-venue-search-no-semantics","title":"Mode 3: Basic Venue Search \u2014 No Semantics","text":""},{"location":"apis/map/nightlife-query/#request_3","title":"Request","text":"<pre><code>{\n  \"message\": \"Find bars near me\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent_2","title":"AI Intent","text":"<pre><code>{\n  \"type\": \"query\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#response_1","title":"Response","text":"<pre><code>{\n  \"action\": \"both\",\n  \"queryUsed\": {\n    \"lat\": -35.2771,\n    \"lon\": 149.1283,\n    \"radius\": 1200\n  },\n  \"venues\": [\n    {\n      \"id\": \"ChIJ-CBD001_CANBERRA_ASSEMBLY\",\n      \"name\": \"The Assembly\",\n      \"vibe\": \"Trendy cocktail bar\",\n      \"mood\": \"Upbeat and social\",\n      \"amenities\": [\"cocktails\", \"outdoor\", \"seating\"],\n      \"types\": [\"bar\", \"cocktail\"],\n      \"flags\": { \"outdoor\": true },\n      \"location\": {\n        \"lat\": -35.277613,\n        \"lon\": 149.128314,\n        \"geohash\": \"r3dp3d2k2d\",\n        \"distanceMeters\": 42\n      },\n      \"weather\": {\n        \"outdoorScore\": 82,\n        \"sunlight\": { \"level\": \"Excellent\", \"emoji\": \"&lt;emoji&gt;\" },\n        \"updatedAt\": \"2026-01-03T00:40:00Z\"\n      },\n      \"rating\": 4.6,\n      \"reviewCount\": 482\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#frontend-behaviour_2","title":"Frontend Behaviour","text":"<ul> <li>Update map pins</li> <li>Render venue cards</li> <li>Optionally display weather badge</li> </ul>"},{"location":"apis/map/nightlife-query/#mode-4-semantic-search-place-to-dance","title":"Mode 4: Semantic Search \u2014 \u201cPlace to Dance\u201d","text":""},{"location":"apis/map/nightlife-query/#request_4","title":"Request","text":"<pre><code>{\n  \"message\": \"Find me a place to dance\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent_3","title":"AI Intent","text":"<pre><code>{\n  \"type\": \"query\",\n  \"semanticIntent\": \"dance\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#response_2","title":"Response","text":"<pre><code>{\n  \"action\": \"both\",\n  \"queryUsed\": {\n    \"lat\": -35.2771,\n    \"lon\": 149.1283,\n    \"radius\": 1200\n  },\n  \"venues\": [\n    {\n      \"id\": \"ChIJ-CBD002_CANBERRA_MOOSE\",\n      \"name\": \"Mooseheads\",\n      \"vibe\": \"Chaotic multi-floor nightclub\",\n      \"mood\": \"Party-heavy\",\n      \"amenities\": [\"dj\", \"dancefloor\"],\n      \"types\": [\"club\"],\n      \"flags\": {},\n      \"location\": {\n        \"lat\": -35.278941,\n        \"lon\": 149.131702,\n        \"geohash\": \"r3dp3d9k8s\",\n        \"distanceMeters\": 340\n      },\n      \"weather\": null,\n      \"rating\": 3.8,\n      \"reviewCount\": 1124\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#frontend-behaviour_3","title":"Frontend Behaviour","text":"<ul> <li>Treat as filtered result</li> <li>No literal <code>dance</code> field required</li> <li>Explainable: DJ + dancefloor matched</li> </ul>"},{"location":"apis/map/nightlife-query/#mode-5-semantic-weather-outdoor-drinks","title":"Mode 5: Semantic + Weather \u2014 \u201cOutdoor Drinks\u201d","text":""},{"location":"apis/map/nightlife-query/#request_5","title":"Request","text":"<pre><code>{\n  \"message\": \"Outdoor drinks somewhere nice\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent_4","title":"AI Intent","text":"<pre><code>{\n  \"type\": \"query\",\n  \"semanticIntent\": \"outdoor\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#response_3","title":"Response","text":"<pre><code>{\n  \"action\": \"both\",\n  \"queryUsed\": {\n    \"lat\": -35.2771,\n    \"lon\": 149.1283,\n    \"radius\": 1200\n  },\n  \"venues\": [\n    {\n      \"id\": \"ChIJ-CBD010_CANBERRA_PUBLICBAR\",\n      \"name\": \"The Public Bar\",\n      \"vibe\": \"Large modern pub\",\n      \"mood\": \"Sporty &amp; loud\",\n      \"amenities\": [\"outdoor\", \"food\", \"sports\"],\n      \"types\": [\"pub\"],\n      \"flags\": { \"outdoor\": true },\n      \"location\": {\n        \"lat\": -35.2771,\n        \"lon\": 149.12859,\n        \"geohash\": \"r3dp3d2k2p\",\n        \"distanceMeters\": 61\n      },\n      \"weather\": {\n        \"outdoorScore\": 74,\n        \"sunlight\": { \"level\": \"Good\", \"emoji\": \"&lt;emoji&gt;\" }\n      },\n      \"rating\": 4.4,\n      \"reviewCount\": 1480\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#frontend-behaviour_4","title":"Frontend Behaviour","text":"<ul> <li>Highlight weather score</li> <li>Optional \u201cGreat outdoor weather\u201d badge</li> </ul>"},{"location":"apis/map/nightlife-query/#mode-6-location-override-bars-in-braddon","title":"Mode 6: Location Override \u2014 \u201cBars in Braddon\u201d","text":""},{"location":"apis/map/nightlife-query/#request_6","title":"Request","text":"<pre><code>{\n  \"message\": \"Bars in Braddon\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent_5","title":"AI Intent","text":"<pre><code>{\n  \"type\": \"query\",\n  \"locationText\": \"Braddon\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#response_4","title":"Response","text":"<pre><code>{\n  \"action\": \"both\",\n  \"queryUsed\": {\n    \"lat\": -35.2747,\n    \"lon\": 149.1296,\n    \"radius\": 1200\n  },\n  \"venues\": [\n    {\n      \"id\": \"ChIJ-BRADDON011_CANBERRA_LONSDALE\",\n      \"name\": \"Lonsdale Street Roasters Night Bar\",\n      \"vibe\": \"Hipster craft bar\",\n      \"mood\": \"Indie &amp; chilled\",\n      \"amenities\": [\"music\", \"outdoor\"],\n      \"types\": [\"bar\"],\n      \"flags\": { \"outdoor\": true },\n      \"location\": {\n        \"lat\": -35.274985,\n        \"lon\": 149.128791,\n        \"distanceMeters\": 180\n      },\n      \"weather\": {\n        \"outdoorScore\": 68,\n        \"sunlight\": { \"level\": \"Fair\", \"emoji\": \"&lt;emoji&gt;\" }\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#mode-7-refine-search-more-chill","title":"Mode 7: Refine Search \u2014 \u201cMore Chill\u201d","text":""},{"location":"apis/map/nightlife-query/#request_7","title":"Request","text":"<pre><code>{\n  \"message\": \"Something more chill\",\n  \"lat\": -35.2771,\n  \"lon\": 149.1283,\n  \"lastQuery\": {\n    \"radius\": 1200\n  }\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-intent_6","title":"AI Intent","text":"<pre><code>{\n  \"type\": \"refine\",\n  \"semanticIntent\": \"chill\"\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#response_5","title":"Response","text":"<pre><code>{\n  \"action\": \"both\",\n  \"queryUsed\": {\n    \"lat\": -35.2771,\n    \"lon\": 149.1283,\n    \"radius\": 1200\n  },\n  \"venues\": [\n    {\n      \"id\": \"ChIJ-CBD008_CANBERRA_ROCHFORD\",\n      \"name\": \"Bar Rochford\",\n      \"types\": [\"wine\", \"cocktail\"],\n      \"mood\": \"Classy &amp; intimate\"\n    }\n  ]\n}\n</code></pre>"},{"location":"apis/map/nightlife-query/#supported-semantic-intents","title":"Supported Semantic Intents","text":"<pre><code>dance, party, loud, chill, date, beer, cocktails, wine,\nlive_music, outdoor, sports, late_night\n</code></pre>"},{"location":"apis/map/nightlife-query/#ai-guarantees","title":"AI Guarantees","text":"<ul> <li>Never returns code</li> <li>Never invents database fields</li> <li>Never leaks system prompts</li> <li>Uses only known Firestore schema</li> <li>Stable response shapes</li> <li>Explainable semantic logic</li> <li>Safe bounded chat behaviour</li> </ul>"},{"location":"apis/map/nightlife-query/#frontend-contract-critical","title":"Frontend Contract (Critical)","text":"<ul> <li>Always branch UI on <code>action</code></li> <li><code>action = \"message\"</code> \u2192 chat only</li> <li><code>action = \"both\"</code> \u2192 update map + cards</li> <li>Never assume venues exist</li> <li>Always support empty results gracefully</li> </ul>"},{"location":"apis/map/nightlife-query/#error-responses","title":"Error Responses","text":""},{"location":"apis/map/nightlife-query/#400-bad-request","title":"400 Bad Request","text":"<pre><code>{ \"error\": \"Missing or invalid request body\" }\n</code></pre>"},{"location":"apis/map/nightlife-query/#500-internal-server-error","title":"500 Internal Server Error","text":"<pre><code>{ \"error\": \"Internal server error\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/","title":"POST /checkInToVenue","text":"<p>Validates a user's physical presence at a venue, enforces cooldown rules, records engagement, updates loyalty state, and emits crowd signals.</p> <p>Firebase HTTPS Function.</p>"},{"location":"apis/venue/check-in-to-venue/#authentication","title":"Authentication","text":"<p>Required</p> <pre><code>Authorization: Bearer &lt;Firebase ID Token&gt;\n</code></pre> <ul> <li>Token must be a valid Firebase Auth ID token</li> <li>User identity is derived from the token (<code>uid</code>)</li> </ul>"},{"location":"apis/venue/check-in-to-venue/#purpose","title":"Purpose","text":"<p>This endpoint is responsible for:</p> <ul> <li>Verifying proximity to a venue</li> <li>Enforcing anti-spam cooldowns</li> <li>Recording a verified or unverified check-in</li> <li>Updating user\u2013venue visit summaries</li> <li>Emitting anonymous crowd signals for venue ranking</li> </ul> <p>This is a high-trust, server-authoritative endpoint.</p>"},{"location":"apis/venue/check-in-to-venue/#request","title":"Request","text":""},{"location":"apis/venue/check-in-to-venue/#method","title":"Method","text":"<pre><code>POST\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#body","title":"Body","text":"<pre><code>{\n  venueId: string;               // Target venue document ID\n  method: \"gps\" | \"qr\" | \"manual\";\n  crowdLevel: \"quiet\" | \"moderate\" | \"busy\" | \"packed\";\n\n  coords?: {\n    lat: number;\n    lon: number;\n  };\n}\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#crowd-level-mapping","title":"Crowd Level Mapping","text":"<p>User-reported crowd levels are mapped to numeric signals:</p> Crowd Level Signal Value quiet 0.2 moderate 0.5 busy 0.75 packed 1.0 <p>These values are used for aggregation and ranking only.</p>"},{"location":"apis/venue/check-in-to-venue/#distance-verification","title":"Distance Verification","text":"<p>If coordinates are provided, the server calculates the distance between the user and the venue using the Haversine formula.</p>"},{"location":"apis/venue/check-in-to-venue/#constraints","title":"Constraints","text":"Rule Value Maximum distance 75 metres Result Verified check-in <p>If the user is outside this radius, the request is rejected.</p>"},{"location":"apis/venue/check-in-to-venue/#cooldown-rules","title":"Cooldown Rules","text":"<p>To prevent spam and abuse, cooldowns are enforced.</p>"},{"location":"apis/venue/check-in-to-venue/#same-venue-cooldown","title":"Same Venue Cooldown","text":"Rule Value Cooldown 120 minutes Scope Same venue"},{"location":"apis/venue/check-in-to-venue/#cross-venue-cooldown","title":"Cross-Venue Cooldown","text":"Rule Value Cooldown 10 minutes Scope Any other venue <p>Cooldowns are calculated using the most recent check-in timestamp.</p>"},{"location":"apis/venue/check-in-to-venue/#firestore-writes","title":"Firestore Writes","text":""},{"location":"apis/venue/check-in-to-venue/#1-user-check-in-event","title":"1. User Check-in Event","text":"<p>Path</p> <pre><code>users/{uid}/checkins/{checkinId}\n</code></pre> <p>Document</p> <pre><code>{\n  \"type\": \"venue_checkin\",\n  \"venueId\": \"ruby_canberra\",\n  \"venueName\": \"Ruby\",\n  \"method\": \"gps\",\n  \"crowdSignal\": 0.75,\n  \"pointsEarned\": 10,\n  \"verified\": true,\n  \"timestamp\": \"2026-01-05T20:14:00+11:00\"\n}\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#2-uservenue-summary-update","title":"2. User\u2013Venue Summary Update","text":"<p>Path</p> <pre><code>users/{uid}/venues/{venueId}\n</code></pre> <p>Fields Updated</p> <pre><code>{\n  venueId: string;\n  visits: increment(1);\n  lastVisitAt: Timestamp;\n}\n</code></pre> <ul> <li>Uses merge semantics</li> <li>Maintains lightweight per-user venue history</li> </ul>"},{"location":"apis/venue/check-in-to-venue/#3-venue-crowd-signal","title":"3. Venue Crowd Signal","text":"<p>Path</p> <pre><code>venues/{venueId}/signals/{signalId}\n</code></pre> <p>Document</p> <pre><code>{\n  \"timestamp\": \"2026-01-05T20:14:00+11:00\",\n  \"signal\": 0.75,\n  \"weight\": 1.2\n}\n</code></pre> Weight Meaning 1.2 Verified (GPS-confirmed) 1.0 Unverified"},{"location":"apis/venue/check-in-to-venue/#response-200-ok","title":"Response \u2014 200 OK","text":"<pre><code>{\n  \"success\": true,\n  \"pointsAwarded\": 10,\n  \"verified\": true,\n  \"crowdLevel\": \"busy\"\n}\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#error-responses","title":"Error Responses","text":""},{"location":"apis/venue/check-in-to-venue/#400-bad-request","title":"400 Bad Request","text":"<p>Missing or invalid request fields.</p> <pre><code>{ \"error\": \"Missing or invalid request fields\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#401-unauthorized","title":"401 Unauthorized","text":"<p>Missing or invalid auth token.</p> <pre><code>{ \"error\": \"Missing or invalid auth token\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#403-forbidden","title":"403 Forbidden","text":"<p>User too far from venue.</p> <pre><code>{ \"error\": \"User too far from venue\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#404-not-found","title":"404 Not Found","text":"<p>Venue not found.</p> <pre><code>{ \"error\": \"Venue not found\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#429-too-many-requests","title":"429 Too Many Requests","text":"<p>Cooldown violation.</p> <pre><code>{ \"error\": \"Cooldown violation\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#500-internal-server-error","title":"500 Internal Server Error","text":"<p>Internal server error.</p> <pre><code>{ \"error\": \"Internal server error\" }\n</code></pre>"},{"location":"apis/venue/check-in-to-venue/#security-trust-model","title":"Security &amp; Trust Model","text":"<ul> <li>All validation is server-side</li> <li>Distance is computed using trusted venue coordinates</li> <li>Clients cannot spoof verification</li> <li>Crowd data is anonymised before aggregation</li> </ul>"},{"location":"apis/venue/check-in-to-venue/#design-notes","title":"Design Notes","text":"<ul> <li>Check-ins are event-level, append-only</li> <li>Venue state is never modified directly</li> <li>Crowd signals are intentionally numeric</li> <li>This endpoint feeds analytics, ranking, and UX layers</li> </ul> <p>This function is a core pillar of Barfinder's engagement and trust model.</p>"},{"location":"database/account/","title":"Database Schema \u2014 Accounts","text":"<p>This document defines the complete Accounts (Users) data model used by Barfinder.</p> <p>It covers:</p> <ul> <li>Core user profile data</li> <li>Preferences, flags, and loyalty state</li> <li>User check-ins (event-level)</li> <li>Saved shortcuts (local map presets)</li> <li>User\u2013venue relationship snapshots</li> </ul> <p>This file is the single source of truth for all account-related data.</p>"},{"location":"database/account/#collection-overview","title":"Collection Overview","text":"<pre><code>users/{uid}\n</code></pre> <p>Where: - <code>uid</code> is the Firebase Authentication UID - One document per user - All subcollections are user-scoped and private</p>"},{"location":"database/account/#purpose","title":"Purpose","text":"<p>User documents represent identity, preferences, and engagement state. They are used to:</p> <ul> <li>Personalise map discovery</li> <li>Track loyalty, XP, and streaks</li> <li>Secure check-in validation</li> <li>Store client-side shortcuts</li> <li>Support future social features</li> </ul> <p>Accounts are write-moderate, read-heavy, and security-critical.</p>"},{"location":"database/account/#core-user-fields","title":"Core User Fields","text":"<pre><code>{\n  uid: string;\n\n  displayName: string | null;\n  firstName: string | null;\n  lastName: string | null;\n\n  email: string | null;\n  emailVerified: boolean;\n\n  avatarUrl: string | null;\n\n  status: \"active\" | \"suspended\";\n\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n  lastActiveAt: Timestamp;\n}\n</code></pre>"},{"location":"database/account/#flags-permissions-controls","title":"Flags (Permissions &amp; Controls)","text":"<pre><code>flags: {\n  locationAccess: boolean;\n  notifications: boolean;\n  marketingUpdates: boolean;\n  shareStatus: boolean;\n  betaEnabled?: boolean;\n}\n</code></pre>"},{"location":"database/account/#notes","title":"Notes","text":"<ul> <li>Flags are explicitly controlled</li> <li>Used for feature gating and legal compliance</li> <li>Never inferred client-side</li> </ul>"},{"location":"database/account/#preferences-discovery-taste","title":"Preferences (Discovery &amp; Taste)","text":"<pre><code>preferences: {\n  vibes?: string[];              // [\"dance\", \"cocktails\"]\n  music?: string[];              // [\"house\", \"techno\"]\n  crowdTolerance?: \"low\" | \"medium\" | \"high\";\n}\n</code></pre>"},{"location":"database/account/#loyalty-progression","title":"Loyalty &amp; Progression","text":"<pre><code>loyalty: {\n  level: number;\n  points: number;\n  xp: number;\n\n  streakDays: number;\n  reputation?: string;\n\n  lastVisitAt?: Timestamp;\n}\n</code></pre>"},{"location":"database/account/#membership-optional-future","title":"Membership (Optional / Future)","text":"<pre><code>membership: {\n  tier: \"Free\" | \"Pro\" | \"Extreme\";\n  expiresAt?: Timestamp;\n  source?: \"ios\" | \"android\" | \"web\";\n}\n</code></pre>"},{"location":"database/account/#user-subcollections","title":"User Subcollections","text":""},{"location":"database/account/#1-check-ins-verified-engagement","title":"1. Check-ins (Verified Engagement)","text":""},{"location":"database/account/#collection-path","title":"Collection Path","text":"<pre><code>users/{uid}/checkins/{checkinId}\n</code></pre>"},{"location":"database/account/#purpose_1","title":"Purpose","text":"<p>Check-ins represent explicit, location-verified visits to venues. They are used to:</p> <ul> <li>Award points and XP</li> <li>Maintain streaks</li> <li>Generate venue signals</li> <li>Populate user history</li> </ul> <p>See Check In To Venue for the API flow that writes these records.</p>"},{"location":"database/account/#validation-rules-server-enforced","title":"Validation Rules (Server-Enforced)","text":"<ul> <li>User must be within 20 metres of venue location</li> <li>Cooldown enforced between check-ins</li> <li>GPS or trusted method required</li> <li>Fraud score computed per event</li> </ul>"},{"location":"database/account/#document-structure","title":"Document Structure","text":"<pre><code>{\n  type: \"venue_checkin\";\n\n  venueId: string;\n  venueName: string;\n\n  method: \"gps\" | \"qr\" | \"manual\";\n  verified: boolean;\n\n  fraudScore: number;            // 0.0 \u2013 1.0\n\n  pointsEarned: number;\n  xpEarned: number;\n\n  timestamp: Timestamp;\n}\n</code></pre>"},{"location":"database/account/#concrete-example","title":"Concrete Example","text":"<p>Path</p> <pre><code>users/iHDTUHXP1NDqmsVb6ZoIT1jk003/checkins/chk_20250105_001\n</code></pre> <p>Document</p> <pre><code>{\n  \"type\": \"venue_checkin\",\n  \"venueId\": \"ruby_canberra\",\n  \"venueName\": \"Ruby\",\n  \"method\": \"gps\",\n  \"verified\": true,\n  \"fraudScore\": 0.02,\n  \"pointsEarned\": 10,\n  \"xpEarned\": 10,\n  \"timestamp\": \"2025-12-21T14:07:27+11:00\"\n}\n</code></pre>"},{"location":"database/account/#2-shortcuts-saved-map-presets","title":"2. Shortcuts (Saved Map Presets)","text":""},{"location":"database/account/#collection-path_1","title":"Collection Path","text":"<pre><code>users/{uid}/shortcuts/{shortcutId}\n</code></pre>"},{"location":"database/account/#purpose_2","title":"Purpose","text":"<p>Shortcuts allow users to save reusable discovery queries. They:</p> <ul> <li>Open the map with prefilled filters</li> <li>Bypass AI and server logic</li> <li>Query Firestore directly</li> </ul> <p>Saved shortcut searches are passed to Get Nearby Venues.</p>"},{"location":"database/account/#document-structure_1","title":"Document Structure","text":"<pre><code>{\n  name: string;\n\n  filters: {\n    amenities?: string[];\n    tags?: string[];\n    types?: string[];\n\n    openNow?: boolean;\n    lateNight?: boolean;\n\n    radiusKm: number;\n  };\n\n  createdAt: Timestamp;\n}\n</code></pre>"},{"location":"database/account/#concrete-example_1","title":"Concrete Example","text":"<p>Path</p> <pre><code>users/iHDTUHXP1NDqmsVb6ZoIT1jk003/shortcuts/2w7ZCNGhBpUskaXRPhwH\n</code></pre> <p>Document</p> <pre><code>{\n  \"name\": \"Play Pool\",\n  \"filters\": {\n    \"amenities\": [\"Pool table\"],\n    \"openNow\": false,\n    \"lateNight\": false,\n    \"radiusKm\": 10\n  },\n  \"createdAt\": \"2025-12-22T09:44:14+11:00\"\n}\n</code></pre>"},{"location":"database/account/#3-uservenue-relationship-snapshots","title":"3. User\u2013Venue Relationship Snapshots","text":""},{"location":"database/account/#collection-path_2","title":"Collection Path","text":"<pre><code>users/{uid}/venues/{venueId}\n</code></pre>"},{"location":"database/account/#purpose_3","title":"Purpose","text":"<p>Stores per-user, per-venue state without polluting core venue docs. Used for:</p> <ul> <li>Visit counts</li> <li>Streak tracking</li> <li>Reward unlocking</li> <li>UI badges</li> </ul>"},{"location":"database/account/#document-structure_2","title":"Document Structure","text":"<pre><code>{\n  venueId: string;\n\n  visits: number;\n  verifiedCheckins: number;\n\n  streak: number;\n\n  lastVisitAt: Timestamp;\n  lastCheckinMethod: \"gps\" | \"qr\";\n\n  unlockedRewards?: string[];\n}\n</code></pre>"},{"location":"database/account/#concrete-example_2","title":"Concrete Example","text":"<p>Path</p> <pre><code>users/iHDTUHXP1NDqmsVb6ZoIT1jk003/venues/ruby_canberra\n</code></pre> <p>Document</p> <pre><code>{\n  \"venueId\": \"ruby_canberra\",\n  \"visits\": 10,\n  \"verifiedCheckins\": 8,\n  \"streak\": 3,\n  \"lastVisitAt\": \"2025-12-21T14:07:27+11:00\",\n  \"lastCheckinMethod\": \"gps\",\n  \"unlockedRewards\": [\"free_drink\"]\n}\n</code></pre>"},{"location":"database/account/#read-write-patterns","title":"Read &amp; Write Patterns","text":"Operation Firestore Path Profile read users/{uid} Update flags users/{uid} Check-in write users/{uid}/checkins Shortcut read users/{uid}/shortcuts Venue history users/{uid}/venues Signal generation venues/{venueId}/signals"},{"location":"database/account/#design-principles","title":"Design Principles","text":"<ul> <li>User data is strictly scoped</li> <li>No venue joins required for history</li> <li>Event data is append-only</li> <li>Shortcuts are client-owned</li> <li>All critical validation is server-side</li> </ul> <p>This schema enables secure engagement tracking while keeping map discovery fast and flexible.</p>"},{"location":"database/venues/","title":"Database Schema \u2014 Venues","text":"<p>This document defines the complete Venues data model used by Barfinder.</p> <p>It covers:</p> <ul> <li>Core venue documents</li> <li>Geo-indexing and discovery fields</li> <li>Flags, weather, and live context</li> <li>Event-level subcollections (signals)</li> <li>Relationships to user check-ins</li> </ul> <p>This file is intended to be the single source of truth for all venue-related data.</p>"},{"location":"database/venues/#collection-overview","title":"Collection Overview","text":"<pre><code>venues/{venueId}\n</code></pre> <p>Where:</p> <ul> <li><code>venueId</code> is a canonical, stable identifier</li> <li>Format mirrors Google Places\u2013style IDs</li> <li>One document per real-world venue</li> </ul>"},{"location":"database/venues/#purpose","title":"Purpose","text":"<p>Venue documents represent real nightlife locations and are used to:</p> <ul> <li>Render map pins and venue cards</li> <li>Support radius-based discovery</li> <li>Enable semantic filtering</li> <li>Attach computed context (weather, activity)</li> <li>Aggregate engagement signals</li> </ul> <p>Venues are read-heavy, write-light, and optimised for map-based queries.</p>"},{"location":"database/venues/#core-venue-fields","title":"Core Venue Fields","text":"<pre><code>{\n  name: string;\n\n  vibe: string | null;            // Human-readable description\n  mood: string | null;            // Abstract emotional tone (used by AI)\n\n  rating: number | null;\n  reviewCount: number;\n\n  amenities: string[];            // [\"cocktails\", \"dj\", \"outdoor\"]\n  types: string[];                // [\"bar\", \"cocktail\", \"club\"]\n}\n</code></pre>"},{"location":"database/venues/#notes","title":"Notes","text":"<ul> <li><code>vibe</code> is descriptive and user-facing</li> <li><code>mood</code> is abstract and used only for semantic reasoning</li> <li>Arrays are additive and non-exclusive</li> </ul>"},{"location":"database/venues/#location-geo-indexed","title":"Location (Geo-indexed)","text":"<pre><code>location: {\n  lat: number;\n  lon: number;\n  geohash: string;\n}\n</code></pre>"},{"location":"database/venues/#notes_1","title":"Notes","text":"<ul> <li>Geohash is required for radius queries</li> <li>Lat/lon used for distance calculation</li> <li>Never inferred or modified at query time</li> </ul>"},{"location":"database/venues/#flags-fast-machine-readable","title":"Flags (Fast, Machine-readable)","text":"<pre><code>flags: {\n  outdoor?: boolean;\n  rooftop?: boolean;\n  lateNight?: boolean;\n  food?: boolean;\n}\n</code></pre>"},{"location":"database/venues/#important","title":"Important","text":"<ul> <li>Flags are not duplicated in amenities</li> <li>Used for deterministic filtering and weather logic</li> <li>Boolean by design for predictable behaviour</li> </ul>"},{"location":"database/venues/#live-state-optional","title":"Live State (Optional)","text":"<pre><code>live: {\n  status: \"quiet\" | \"calm\" | \"busy\" | \"packed\";\n}\n</code></pre>"},{"location":"database/venues/#notes_2","title":"Notes","text":"<ul> <li>Represents transient crowd state</li> <li>May be derived from signals or external inputs</li> <li>Optional and non-blocking</li> </ul>"},{"location":"database/venues/#weather-computed","title":"Weather (Computed)","text":"<pre><code>weather: {\n  outdoorScore: number;           // 0\u2013100\n\n  sunlight: {\n    level: \"Excellent\" | \"Good\" | \"Fair\" | \"Poor\" | \"Minimal\";\n    emoji: string;\n  };\n\n  temperature: number;            // \u00b0C\n  windSpeed: number;              // km/h\n  uvIndex: number;\n\n  updatedAt: Timestamp;\n}\n</code></pre>"},{"location":"database/venues/#notes_3","title":"Notes","text":"<ul> <li>Computed via scheduled Cloud Functions</li> <li>Not user-editable</li> <li>Same baseline weather reused across venues</li> </ul>"},{"location":"database/venues/#metadata","title":"Metadata","text":"<pre><code>createdAt: Timestamp;\nupdatedAt: Timestamp;\n</code></pre>"},{"location":"database/venues/#venue-subcollections","title":"Venue Subcollections","text":"<p>Venue subcollections store event-level and derived data. They are append-only, time-based, and optimised for aggregation.</p>"},{"location":"database/venues/#1-signals-engagement-events","title":"1. Signals (Engagement Events)","text":""},{"location":"database/venues/#collection-path","title":"Collection Path","text":"<pre><code>venues/{venueId}/signals/{signalId}\n</code></pre>"},{"location":"database/venues/#purpose_1","title":"Purpose","text":"<p>Signals represent atomic engagement events indicating real-world activity. They are used to:</p> <ul> <li>Infer crowd momentum</li> <li>Weight popularity and recency</li> <li>Feed ranking and analytics pipelines</li> <li>Support future real-time indicators</li> </ul>"},{"location":"database/venues/#document-structure","title":"Document Structure","text":"<pre><code>{\n  signal: number;               // Encoded event type\n  weight: number;               // Importance multiplier\n  timestamp: Timestamp;         // When the event occurred\n}\n</code></pre>"},{"location":"database/venues/#concrete-example","title":"Concrete Example","text":"<p>Path</p> <pre><code>venues/ChIJ-BRADDON011_CANBERRA_LONSDALE/signals/HYcVbkJ7D6cUrA3s9NqP\n</code></pre> <p>Document</p> <pre><code>{\n  \"signal\": 1,\n  \"weight\": 1.2,\n  \"timestamp\": \"2025-12-22T16:55:15+11:00\"\n}\n</code></pre>"},{"location":"database/venues/#signal-semantics","title":"Signal Semantics","text":"Field Meaning <code>signal</code> Encoded event category (e.g. check-in, dwell, interaction) <code>weight</code> Adjusts contribution strength <code>timestamp</code> Server-generated event time"},{"location":"database/venues/#design-notes","title":"Design Notes","text":"<ul> <li>Append-only</li> <li>No updates or deletes</li> <li>Cheap to write</li> <li>Aggregated asynchronously</li> <li>Never queried directly by clients</li> </ul>"},{"location":"database/venues/#2-relationship-to-user-check-ins","title":"2. Relationship to User Check-ins","text":"<p>User check-ins generate venue signals, but are stored separately.</p>"},{"location":"database/venues/#user-check-in-path","title":"User Check-in Path","text":"<pre><code>users/{uid}/checkins/{checkinId}\n</code></pre>"},{"location":"database/venues/#venue-signal-path","title":"Venue Signal Path","text":"<pre><code>venues/{venueId}/signals/{signalId}\n</code></pre>"},{"location":"database/venues/#flow","title":"Flow","text":"<pre><code>users/{uid}/checkins/{checkinId}\n  \u2192 venues/{venueId}/signals/{signalId}\n</code></pre> <p>This separation allows: - Read-efficient venue queries - Write-efficient user activity tracking - Independent retention policies</p> <p>See Check In To Venue for the check-in flow that emits signals.</p>"},{"location":"database/venues/#read-write-patterns","title":"Read &amp; Write Patterns","text":"Operation Firestore Path Venue discovery venues Radius query venues (geohash) Check-in write users/{uid}/checkins Signal write venues/{venueId}/signals Ranking aggregated signals Analytics derived from signals"},{"location":"database/venues/#retention-aggregation-strategy","title":"Retention &amp; Aggregation Strategy","text":"<ul> <li>Signals may be:</li> <li>Windowed (e.g. last 2 hours)</li> <li>Aggregated into counters</li> <li>Downsampled for long-term trends</li> <li>Raw signal documents can expire safely</li> <li>Core venue document remains stable</li> </ul>"},{"location":"database/venues/#design-principles","title":"Design Principles","text":"<ul> <li>Event data is never embedded in venue documents</li> <li>No duplicated or inferred fields</li> <li>All semantics map to known schema</li> <li>Optimised for read-heavy workloads</li> <li>Safe to evolve without breaking clients</li> </ul>"},{"location":"local_functions/create-shortcut/","title":"Create Shortcut","text":"<p>This document describes the Create Shortcut.</p> <p>Unlike other features, shortcuts are entirely client-driven and do not rely on Cloud Functions or AI interaction. They are stored directly under the user document in Firestore and are used to open the map with preconfigured filters.</p> <p>Related schema: Accounts Database Schema. Shortcuts are returned in directly from firestore.</p>"},{"location":"local_functions/create-shortcut/#feature-overview","title":"Feature Overview","text":"<p>Shortcuts allow users to:</p> <ul> <li>Save reusable venue discovery filters</li> <li>Instantly open the map in a known state</li> <li>Bypass AI intent parsing</li> <li>Query Firestore directly using deterministic filters</li> </ul> <p>A shortcut is best thought of as a named map preset.</p>"},{"location":"local_functions/create-shortcut/#storage-location","title":"Storage Location","text":"<p>Shortcuts are stored per-user.</p>"},{"location":"local_functions/create-shortcut/#firestore-path","title":"Firestore Path","text":"<pre><code>users/{uid}/shortcuts/{shortcutId}\n</code></pre> <ul> <li><code>uid</code> is the Firebase Authentication user ID</li> <li><code>shortcutId</code> is auto-generated</li> <li>All shortcuts are private to the user</li> </ul>"},{"location":"local_functions/create-shortcut/#data-model","title":"Data Model","text":"<pre><code>{\n  name: string;\n\n  filters: {\n    types?: string[];\n    amenities?: string[];\n    tags?: string[];\n\n    openNow?: boolean;\n    lateNight?: boolean;\n\n    radiusKm?: number;\n  };\n\n  createdAt: Timestamp;\n}\n</code></pre>"},{"location":"local_functions/create-shortcut/#example-document","title":"Example Document","text":"<p>Path</p> <pre><code>users/iHDTUHXP1NDqmsVb6ZoIT1jk003/shortcuts/2w7ZCNGhBpUskaXRPhwH\n</code></pre> <p>Document</p> <pre><code>{\n  \"name\": \"Play Pool\",\n  \"filters\": {\n    \"amenities\": [\"Pool table\"],\n    \"openNow\": false,\n    \"lateNight\": false,\n    \"radiusKm\": 10\n  },\n  \"createdAt\": \"2025-12-22T09:44:14+11:00\"\n}\n</code></pre>"},{"location":"local_functions/create-shortcut/#user-flow-ui","title":"User Flow (UI)","text":"<p>The shortcut creation flow is implemented as a multi-step modal builder.</p>"},{"location":"local_functions/create-shortcut/#steps","title":"Steps","text":"<ol> <li>Name \u2014 required</li> <li>Types \u2014 optional</li> <li>Amenities \u2014 optional</li> <li>Tags \u2014 optional</li> <li>Extras \u2014 open now, late night, radius</li> </ol>"},{"location":"local_functions/create-shortcut/#save-usage","title":"Save &amp; Usage","text":"<p>Shortcuts are saved directly to Firestore and later read by the map screen to execute deterministic venue queries without invoking AI or Cloud Functions.</p>"}]}